<h1><%= @post.title %></h1>
<p><%= @post.content %></p>
<p><strong>user email : </strong><%= @post.user.present? ? @post.user.email : 'No user id' %></p>

<script>
    $(document).ready(function() {
        // Check if the user is logged in
        var loggedIn = <%= user_signed_in? %>;

        // Make an AJAX call to mark the post as read if the user is logged in
        if (loggedIn) {
            var csrfToken = $('meta[name=csrf-token]').attr('content');

            $.ajax({
                url: "/topics/<%= @topic.id %>/posts/<%= @post.id %>/mark_as_read",
                type: "PATCH",
                headers: {
                    'X-CSRF-Token': csrfToken
                },
                success: function(response) {
                    console.log("Post marked as read");
                    // You can update the UI as needed
                },
                error: function(error) {
                    console.error("Error marking post as read");
                }
            });
        }
    });
</script>

<!-- Display read/unread status -->
<p><strong>Status:</strong> <%= @post.marked_as_read?(current_user) ? 'Read' : 'Unread' %></p>


<% if @post.image.attached? %>
  <%= image_tag(@post.image, class: "image") %>
<%else %>
  <strong>No images added</strong>
<% end %>
<br><br>
<h2>Tags:</h2>
<% if @post.tags.any? %>
  <% @post.tags.each do |tag| %>
    <%= tag.name %>
  <% end %>
<% else %>
  No tags available for this post.
<% end %>
<br><br>

<!-- Display existing user_comment_ratings -->
<h2>Ratings:</h2>
<ul>
  <% @ratings.each do |star, count| %>
    <li><%= star %> Star Ratings: <%= count %></li>
  <% end %>
</ul>

<!-- Rating form -->
<%= form_for([@topic, @post, @post.ratings.build]) do |f| %>
  <%= f.label :value %>
  <%= f.radio_button :value, 1 %> 1 Star
  <%= f.radio_button :value, 2 %> 2 Stars
  <%= f.radio_button :value, 3 %> 3 Stars
  <%= f.radio_button :value, 4 %> 4 Stars
  <%= f.radio_button :value, 5 %> 5 Stars
  <%= f.submit "Submit Rating" %>
<% end %>
<br>
<% if can? :edit, @post %>
  |  <%= link_to 'Edit Post', edit_topic_post_path(@topic,@post) %>  |
<% end %>
|  <%= link_to "show comments" ,topic_post_comments_path(@topic,@post)  %>  |
<%= button_to "Delete", topic_posts_path(@topic), method: :delete, data: { confirm: "Are you sure?" } %><br/>
<%= link_to "Back", topic_posts_path(@topic, @post), class: "btn btn-secondary" %>